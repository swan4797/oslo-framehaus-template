---
// ========================================
// ARTICLE HERO COMPONENT
// Hero section for blog article pages
// ========================================

interface Category {
  category_id: string
  name: string
}

interface Author {
  full_name: string
  job_title?: string | null
  profile_photo_url?: string | null
}

interface Props {
  title: string
  imageUrl: string
  imageAlt?: string | null
  categories?: Category[] | null
  author?: Author | null
  publishedAt?: string | null
  readingTime: number
  viewCount?: number
}

const {
  title,
  imageUrl,
  imageAlt,
  categories = [],
  author,
  publishedAt,
  readingTime,
  viewCount = 0
} = Astro.props

// Format date helper
const formatDate = (dateString: string | null | undefined) => {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('en-GB', {
    day: 'numeric',
    month: 'long',
    year: 'numeric'
  })
}

// Default author image
const authorImage = author?.profile_photo_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(author?.full_name || 'Author')}&size=160&background=FF5A5F&color=fff`
---

<header class="article-hero">
  <div class="article-hero__image-container">
    <img
      src={imageUrl}
      alt={imageAlt || title}
      class="article-hero__image"
    />
    <div class="article-hero__overlay"></div>
  </div>

  <div class="article-hero__content">
    <div class="article-hero__container">
      {categories && categories.length > 0 && (
        <div class="article-hero__categories">
          {categories.map(cat => (
            <a href={`/blog?category=${cat.category_id}`} class="article-hero__category">
              {cat.name}
            </a>
          ))}
        </div>
      )}

      <h1 class="article-hero__title">{title}</h1>

      <div class="article-hero__meta">
        {author && (
          <div class="article-hero__author">
            <img
              src={authorImage}
              alt={author.full_name}
              class="article-hero__author-avatar"
            />
            <div class="article-hero__author-details">
              <span class="article-hero__author-name">{author.full_name}</span>
              {author.job_title && (
                <span class="article-hero__author-title">{author.job_title}</span>
              )}
            </div>
          </div>
        )}

        <div class="article-hero__meta-divider"></div>

        <div class="article-hero__info">
          <time datetime={publishedAt || ''} class="article-hero__date">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
              <line x1="16" x2="16" y1="2" y2="6"/>
              <line x1="8" x2="8" y1="2" y2="6"/>
              <line x1="3" x2="21" y1="10" y2="10"/>
            </svg>
            {formatDate(publishedAt)}
          </time>
          <span class="article-hero__reading-time">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            {readingTime} min read
          </span>
          {viewCount > 0 && (
            <span class="article-hero__views">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              {viewCount.toLocaleString()} views
            </span>
          )}
        </div>
      </div>
    </div>
  </div>
</header>
