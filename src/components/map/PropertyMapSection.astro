---
// ========================================
// PROPERTY MAP SECTION COMPONENT
// Premium layered two-column composition
// Server-rendered Astro version
// ========================================

interface Props {
  latitude: number
  longitude: number
  address: string
  postcode?: string
  displayAddress?: string
  provider?: 'openstreetmap' | 'google'
  googleApiKey?: string
}

const {
  latitude,
  longitude,
  address,
  postcode,
  displayAddress,
  provider = 'openstreetmap',
  googleApiKey
} = Astro.props

// Generate iframe URL based on provider
const getMapUrl = (): string => {
  if (provider === 'google' && googleApiKey) {
    return `https://www.google.com/maps/embed/v1/place?key=${googleApiKey}&q=${encodeURIComponent(address || `${latitude},${longitude}`)}&zoom=15&center=${latitude},${longitude}`
  }
  // OpenStreetMap (free, no API key needed)
  const bbox = `${longitude - 0.005},${latitude - 0.005},${longitude + 0.005},${latitude + 0.005}`
  return `https://www.openstreetmap.org/export/embed.html?bbox=${bbox}&layer=mapnik&marker=${latitude},${longitude}`
}

const mapUrl = getMapUrl()
---

<section class="map-section">
  <div class="map-section__layout">
    <!-- Left Column - Map (Overlapping) -->
    <div class="map-section__map-column">
      <div class="map-section__map-wrapper">
        <iframe
          title="Property Location Map"
          src={mapUrl}
          width="100%"
          height="100%"
          loading="lazy"
          allowfullscreen
          referrerpolicy="no-referrer-when-downgrade"
        />
      </div>
    </div>

    <!-- Right Column - Colored Panel -->
    <div class="map-section__panel-column">
      <div class="map-section__content">
        <!-- Eyebrow Label -->
        <span class="map-section__eyebrow">Property Location</span>

        <!-- Primary Heading -->
        <h2 class="map-section__heading">
          Discover the<br />Neighbourhood
        </h2>

        <!-- Address -->
        <p class="map-section__address">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
            <circle cx="12" cy="10" r="3" />
          </svg>
          <span>
            {displayAddress || address}
            {postcode && `, ${postcode}`}
          </span>
        </p>

        <!-- Body Text -->
        <p class="map-section__text">
          Explore the surrounding area, local amenities, and transport links to get a feel for this location.
        </p>

        <!-- Action Links -->
        <div class="map-section__actions">
          <a
            href={`https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`}
            target="_blank"
            rel="noopener noreferrer"
            class="map-section__btn-primary"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="10" r="3" />
              <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 6.9 8 11.7z" />
            </svg>
            Open in Google Maps
          </a>

          <div class="map-section__secondary-links">
            <a
              href={`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${latitude},${longitude}`}
              target="_blank"
              rel="noopener noreferrer"
              class="map-section__link"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
              Street View
            </a>

            <span class="map-section__divider">Â·</span>

            <a
              href={`https://www.google.com/maps/dir/?api=1&destination=${latitude},${longitude}`}
              target="_blank"
              rel="noopener noreferrer"
              class="map-section__link"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
                <path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z" />
              </svg>
              Get Directions
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<style lang="scss" is:global>
  @use '../../styles/pages/property-details/map';
</style>
