---
// ========================================
// HOMEPAGE
// UK Estate Agent Homepage - Clean Modern Design
// Dynamic content from Stratos CRM
// ========================================

import Layout from '../layouts/Layout.astro'
import PropertySearch from '../components/search/PropertySearch.astro'
import Hero from '../components/Hero.astro'
import ServiceGrid from '../components/static-page/layouts/ServiceGrid.astro'
import ContentBlock from '../components/static-page/layouts/ContentBlock.astro'
import CTABanner from '../components/static-page/layouts/CTABanner.astro'
import IntroSection from '../components/static-page/layouts/IntroSection.astro'
import PropertyGridSlider from '../components/properties/grids/PropertyGridSlider.astro'
import ReviewCarousel from '../components/reviews/ReviewCarousel.astro'
import { siteConfig } from '../lib/config'
import PropertyGrid from '../components/properties/grids/PropertyGrid.astro'

// Brand utilities
import {
  fetchBrandSettings,
  getContactInfo,
  getSocialLinks,
} from '../lib/brand'

// Page content utilities
import {
  getPageContent,
  getSectionTitle,
  getSectionContent,
  getSectionImage,
  getHeroImage,
  hasSection,
} from '../lib/pages'

// Fetch brand settings
const brand = await fetchBrandSettings(true)
const contact = getContactInfo(brand)

// Fetch homepage content from Stratos CRM
const pageContent = await getPageContent('homepage')

// Get hero image from CMS
const heroImage = getHeroImage(pageContent)

// ========================================
// CMS SECTION DATA
// ========================================

// Featured Properties section (block_key: featured_properties)
const featuredTitle = getSectionTitle(pageContent, 'featured_properties', 'Featured Properties')
const featuredContent = getSectionContent(pageContent, 'featured_properties', '<p>Discover our handpicked selection of premium properties.</p>')
const featuredImage = getSectionImage(pageContent, 'featured_properties')

// Why Choose Us section (block_key: why_choose_us)
const whyChooseTitle = getSectionTitle(pageContent, 'why_choose_us', 'Why Choose Us')
const whyChooseContent = getSectionContent(pageContent, 'why_choose_us', '')
const whyChooseImage = getSectionImage(pageContent, 'why_choose_us')

// Services section (block_key: services)
const servicesTitle = getSectionTitle(pageContent, 'services', '')
const servicesContent = getSectionContent(pageContent, 'services', '')
const servicesImage = getSectionImage(pageContent, 'services')

// Testimonials section (block_key: testimonials)
const testimonialsTitle = getSectionTitle(pageContent, 'testimonials', 'What Our Clients Say')
const testimonialsContent = getSectionContent(pageContent, 'testimonials', '')
const testimonialsImage = getSectionImage(pageContent, 'testimonials')

// Areas section (block_key: areas)
const areasTitle = getSectionTitle(pageContent, 'faqs_section', '')
const areasContent = getSectionContent(pageContent, 'faqs_section', '')
const areasImage = getSectionImage(pageContent, 'faqs_section')

// CTA section (block_key: cta)
const ctaTitle = getSectionTitle(pageContent, 'cta', '')
const ctaContent = getSectionContent(pageContent, 'cta', '')
const ctaImage = getSectionImage(pageContent, 'cta')

// Check which sections exist in CRM
const hasFeaturedSection = hasSection(pageContent, 'featured_properties')
const hasWhyChooseSection = hasSection(pageContent, 'why_choose_us')
const hasServicesSection = hasSection(pageContent, 'services')
const hasTestimonialsSection = hasSection(pageContent, 'testimonials')
const hasAreasSection = hasSection(pageContent, 'areas')
const hasCtaSection = hasSection(pageContent, 'cta')

// ========================================
// REVIEWS DATA
// Sample reviews for the homepage carousel
// ========================================

const reviews = [
  {
    id: '1',
    quote: "From our first meeting to completion, the team provided exceptional service. They understood exactly what we were looking for and found us our dream home within weeks.",
    author: {
      name: "Sarah & James Mitchell",
      location: "Kensington, London",
    },
    rating: 5,
    source: "Google",
    transactionType: "Purchase",
    propertyType: "4 Bed Victorian Terrace",
  },
  {
    id: '2',
    quote: "Selling our family home was emotional, but the team made the process smooth and stress-free. They achieved a price above our expectations and kept us informed every step of the way.",
    author: {
      name: "Robert Thompson",
      location: "Chelsea, London",
    },
    rating: 5,
    source: "Trustpilot",
    transactionType: "Sale",
    propertyType: "3 Bed Apartment",
  },
  {
    id: '3',
    quote: "Outstanding local knowledge and genuine care for their clients. They went above and beyond to ensure we found the perfect property for our growing family.",
    author: {
      name: "Emma & David Chen",
      location: "Fulham, London",
    },
    rating: 5,
    source: "Google",
    transactionType: "Purchase",
    propertyType: "5 Bed Detached",
  },
  {
    id: '4',
    quote: "Professional, responsive, and truly dedicated. The lettings team found us excellent tenants within days and manage everything seamlessly.",
    author: {
      name: "Michael Andrews",
      location: "Notting Hill, London",
    },
    rating: 5,
    source: "Google",
    transactionType: "Let",
    propertyType: "2 Bed Flat",
  },
  {
    id: '5',
    quote: "We've used them for three property transactions now. Consistently excellent service, honest advice, and they always deliver results.",
    author: {
      name: "Patricia & John Williams",
      location: "Richmond, London",
    },
    rating: 5,
    source: "Trustpilot",
    transactionType: "Sale",
    propertyType: "Period Townhouse",
  },
]


---

<Layout>
  <!-- Hero Section -->
  <Hero
    headline={pageContent?.page_title || brand.tagline || "A Sprawling Coastal Escape"}
    description={pageContent?.content || brand.mission_statement || "Discover exceptional properties with personalized service from our experienced local team."}
    ctaText="Start your search"
    ctaLink="/search"
    backgroundType="image"
    backgroundSrc={heroImage?.url || "https://images.pexels.com/photos/3614082/pexels-photo-3614082.jpeg"}
    overlayOpacity="medium"
  />

  <IntroSection
    subtitle="OUR PURPOSE"
    title={whyChooseTitle || "Connecting Technology with Agriculture"}
    description={whyChooseContent || "Our goal is to support farmers..."}
    ctaText="Learn More"
    ctaLink="/about"
    featuredMediaSrc={whyChooseImage?.url || "https://videos.pexels.com/video-files/3253079/3253079-uhd_2560_1440_25fps.mp4"}
    featuredMediaType={whyChooseImage?.url ? "image" : "video"}
    videoAutoplay={true}
    stats={[
      { value: "75%", label: "Of users report improved decision-making", variant:
  "accent" },
      { value: "250+", label: "Successful field implementations", variant: "light" },
      { value: "Expert-Led", label: "Solutions developed with specialists", variant:
  "image", imageSrc: "https://images.pexels.com/photos/5644365/pexels-photo-5644365.jpeg" }
    ]}
  />

  <!-- Latest Properties - Uses filter props for automatic data fetching -->
  <PropertyGridSlider
    title={featuredTitle}
    subtitle={hasFeaturedSection && featuredContent ? featuredContent : 'Our latest properties for sale and to rent'}
    ctaText="View All Properties"
    source="homepage"
    layout="slider"
    sectionId="latest-properties"
    limit={6}
    sortBy="newest"
    listingStatus="available"
  />

  <!-- Why Choose Us - Bento Layout -->
  <ServiceGrid
    title={servicesTitle || "Why <em>Choose</em> us"}
    layout="bento"
    items={[
      {
        id: '1',
        title: 'End-to-End Solutions',
        description: 'We manage every aspect of your furnishing project, saving you time and resources.',
        mediaSrc: servicesImage?.url || 'https://images.pexels.com/photos/5644365/pexels-photo-5644365.jpeg',
        href: '#'
      },
      {
        id: '2',
        title: 'After-Sales Support',
        description: 'We are committed to providing ongoing support & after-sales service to address any future needs or concerns.',
        mediaSrc: 'https://images.pexels.com/photos/5490364/pexels-photo-5490364.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
        href: '#'
      },
      {
        id: '3',
        title: 'No Variety Restrictions',
        description: 'We partner with any vendor meeting our quality standards, providing the broadest selection of furniture solutions to suit your needs and preferences.',
        mediaSrc: 'https://images.pexels.com/photos/1907784/pexels-photo-1907784.jpeg',
        href: '#',
        overlayOpacity: 'dark'
      },
      {
        id: '4',
        title: 'Superior Quality',
        description: 'Our partnerships with the best suppliers grant us access to the finest materials, craftsmanship, and quality control processes.',
        mediaSrc: 'https://images.pexels.com/photos/1571460/pexels-photo-1571460.jpeg?auto=compress&cs=tinysrgb&w=1200',
        href: '#',
        overlayOpacity: 'medium'
      },
    ]}
  />


  <!-- Client Reviews -->
  <ReviewCarousel
    title={testimonialsTitle}
    subtitle={testimonialsContent || "Trusted by buyers, sellers, and landlords across London"}
    reviews={reviews}
    variant="alt"
    showRating={true}
    showSource={true}
  />

  <ContentBlock
    layout="faq"
    subtitle="FAQS"
    title={areasTitle || "Frequently Asked Questions"}
    mediaSrc={areasImage?.url || "https://images.pexels.com/photos/6782567/pexels-photo-6782567.jpeg?auto=compress&cs=tinysrgb&w=800"}
    imagePosition="right"
    faqItems={[
      { question: "Question 1?", answer: "Answer 1" },
      { question: "Question 2?", answer: "Answer 2" },
    ]}
  />

  <!-- CTA Banner -->
  <CTABanner
    title={ctaTitle || "Thinking of Selling or Letting?"}
    subtitle={ctaContent || "Get an instant online valuation or book a free home visit with our local experts"}
    backgroundType={ctaImage?.url ? "image" : "none"}
    backgroundSrc={ctaImage?.url}
    primaryCtaText="Get Free Valuation"
    primaryCtaLink="/valuation"
    secondaryCtaText={contact.phone ? "Call Us" : ""}
    secondaryCtaLink={contact.phone ? `tel:${contact.phone}` : ""}
  />


</Layout>

<style lang="scss">
  @use '../styles/pages/homepage';
</style>
