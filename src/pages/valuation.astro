---
// ========================================
// VALUATION PAGE
// Modern, premium valuation request form with split layout
// Uses modular form components
// Dynamic contact info from Stratos CRM
// ========================================

import Layout from '../layouts/Layout.astro'
import { fetchBrandSettings, getContactInfo, getSocialLinks } from '../lib/brand'
import type { BrandSettings } from '../types/brand'

// Form Page Components
import FormSplitLayout from '../components/form-page/layout/FormSplitLayout.astro'
import FaqSection from '../components/form-page/faq/FaqSection.astro'
import ContactAlternative from '../components/form-page/card/ContactAlternative.astro'
import FormCardHeader from '../components/form-page/card/FormCardHeader.astro'
import ContactInfoGrid from '../components/form-page/contact-info/ContactInfoGrid.astro'

// Form Component
import ValuationForm from '../components/forms/presets/ValuationForm.astro'

// Configuration
import { valuationPageConfig } from '../components/form-page/config'

// Fetch brand settings from Stratos CRM
let brand: BrandSettings
try {
  brand = await fetchBrandSettings()
} catch (error) {
  console.error('[Valuation] Error fetching brand settings:', error)
  brand = await fetchBrandSettings()
}

// Extract contact info and social links
const contactInfo = getContactInfo(brand)
const socialLinks = getSocialLinks(brand)

const pageTitle = 'Free Property Valuation'
const pageDescription = `Get a free, no-obligation property valuation from ${brand.business_name || 'expert local agents'}. Discover what your home is worth in today's market.`
---

<Layout title={pageTitle} description={pageDescription}>
  <FormSplitLayout
    imageSrc="https://images.pexels.com/photos/18729227/pexels-photo-18729227/free-photo-of-colorful-terraced-houses-in-town-in-uk.jpeg?auto=compress&cs=tinysrgb&w=1920"
    imageAlt="Property valuation"
    overlayOpacity="medium"
    categoryLabel="VALUATION"
  >
    <!-- Page Title -->
    <div class="form-split-section">
      <h1 class="form-split-title">{valuationPageConfig.hero.title}</h1>
      <p class="form-split-subtitle">{valuationPageConfig.hero.subtitle}</p>
    </div>

    <!-- Contact Info Cards -->
    <div class="form-split-section">
      <ContactInfoGrid
        contactInfo={contactInfo}
        socialLinks={socialLinks}
      />
    </div>

    <!-- Form Section -->
    <div class="form-split-section">
      <div class="form-split-card">
        <FormCardHeader
          title="Request your free valuation"
          subtitle="Fill in the form below and we'll arrange a convenient time to visit."
        />
        <ValuationForm />
        <ContactAlternative contactInfo={contactInfo} />
      </div>
    </div>

    <!-- FAQ Section -->
    <div class="form-split-section">
      <FaqSection
        title={valuationPageConfig.faq.title}
        subtitle={valuationPageConfig.faq.subtitle}
        items={valuationPageConfig.faq.items}
      />
    </div>
  </FormSplitLayout>
</Layout>

<style lang="scss">
  @use '../styles/pages/valuation';
</style>
