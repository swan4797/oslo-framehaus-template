---
// ========================================
// LANDLORDS PAGE
// Services page for property landlords
// Dynamic content from Stratos CRM
// ========================================

import Layout from '../layouts/Layout.astro'
import StaticHero from '../components/static-page/StaticHero.astro'
import StaticFullContent from '../components/static-page/StaticFullContent.astro'
import ContentBlock from '../components/static-page/layouts/ContentBlock.astro'
import CTABanner from '../components/static-page/layouts/CTABanner.astro'

// Page content utilities
import {
  getPageContent,
  hasSection,
  getSectionTitle,
  getSectionContent,
  getSectionImage,
  getHeroImage,
} from '../lib/pages'

// Fetch landlords page content from Stratos CRM
const pageContent = await getPageContent('landlords')

// Get hero image from CMS or use fallback
const heroImage = getHeroImage(pageContent)

// Get page title from CMS
const pageTitle = pageContent?.page_title || 'Landlord Services'
const pageDescription = 'Professional letting and property management services for landlords. Maximise your rental income with expert support.'

// Check which sections exist in CMS
const hasServices = hasSection(pageContent, 'services')
const hasWhyLetWithUs = hasSection(pageContent, 'why_let_with_us')
const hasCompliance = hasSection(pageContent, 'compliance')
const hasCta = hasSection(pageContent, 'cta')

// Get section images
const servicesImage = getSectionImage(pageContent, 'services')
const whyLetWithUsImage = getSectionImage(pageContent, 'why_let_with_us')
const complianceImage = getSectionImage(pageContent, 'compliance')
const ctaImage = getSectionImage(pageContent, 'cta')
---

<Layout title={pageTitle} description={pageDescription}>
  <!-- Static Hero Section -->
  <StaticHero
    title={pageTitle}
    description={pageContent?.content || ''}
    brandName="Property Management"
    backgroundType="image"
    backgroundSrc={heroImage?.url || servicesImage?.url || "https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=1920&q=80"}
    backgroundAlt={heroImage?.alt || servicesImage?.alt || "Landlord services"}
    categoryLabel="MANAGEMENT"
    overlayOpacity="light"
  />

  <!-- Services Section -->
  {hasServices && (
    <StaticFullContent
      blockKey="services"
      pageContent={pageContent}
      imageSrc={servicesImage?.url}
      imageAlt={servicesImage?.alt}
    />
  )}

  <!-- Why Let With Us Section -->
  {hasWhyLetWithUs && (
    <ContentBlock
      blockKey="why_let_with_us"
      pageContent={pageContent}
      mediaSrc={whyLetWithUsImage?.url}
      mediaAlt={whyLetWithUsImage?.alt}
      secondaryMediaSrc="https://images.pexels.com/photos/1648839/pexels-photo-1648839.jpeg"
      secondaryMediaAlt="Modern property"
      layout="default"
      imagePosition="right"
    />
  )}

  <!-- Compliance Section -->
  {hasCompliance && (
    <ContentBlock
      blockKey="compliance"
      pageContent={pageContent}
      mediaSrc={complianceImage?.url}
      mediaAlt={complianceImage?.alt}
      secondaryMediaSrc="https://images.pexels.com/photos/2082087/pexels-photo-2082087.jpeg"
      secondaryMediaAlt="Property interior"
      layout="default"
      imagePosition="left"
    />
  )}

  <!-- CTA Section -->
  {hasCta && (
    <CTABanner
      blockKey="cta"
      pageContent={pageContent}
      backgroundType={ctaImage?.url ? "image" : "none"}
      backgroundSrc={ctaImage?.url}
      primaryCtaText="Request Valuation"
      primaryCtaLink="/valuation"
      secondaryCtaText="Contact Us"
      secondaryCtaLink="/contact"
    />
  )}
</Layout>
